var t={d:(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};t.d(n,{Si:()=>q,AT:()=>H,MY:()=>z,yd:()=>X,h8:()=>V,l7:()=>R,gh:()=>U,Rs:()=>k,t$:()=>E,aV:()=>j,XY:()=>N,kC:()=>$,Ws:()=>M,fK:()=>_,wS:()=>g,Xg:()=>I,TA:()=>T,f2:()=>C,ow:()=>G,yr:()=>O,dG:()=>A,tC:()=>w,TW:()=>S,q0:()=>x,xU:()=>L,yB:()=>P,_C:()=>W,lV:()=>F,$P:()=>B,Iz:()=>v,c4:()=>y,od:()=>D,dt:()=>b,FW:()=>m});var e={};t.r(e),t.d(e,{parse:()=>f});var o={};t.r(o),t.d(o,{parse:()=>d});var i={};t.r(i),t.d(i,{isRelURL:()=>g,urlsStrToAbsURLs:()=>b,urlsToAbsURLs:()=>m});var s={};t.r(s),t.d(s,{lineToInlinePlainString:()=>I,lineToPlainString:()=>T,removeAfter:()=>O,removeBefore:()=>A,stdnToInlinePlainString:()=>w,stdnToInlinePlainStringLine:()=>S,stdnToPlainString:()=>x,stringToId:()=>L,unitToInlinePlainString:()=>v,unitToPlainString:()=>y});var r={};t.r(r),t.d(r,{parsePositionStr:()=>C,positionToUnitOrLines:()=>G,stringifyPosition:()=>P});var a={};t.r(a),t.d(a,{extractContext:()=>R,extractGlobalChildren:()=>U,extractGlobalOptionArray:()=>k,extractGlobalStrings:()=>E,extractGlobalURLs:()=>j,extractLastGlobalOption:()=>N,extractPartToOffset:()=>$,extractUnitOrLineToPart:()=>M,extractUnitOrLineToPosition:()=>_,urlToAbsURL:()=>D});var c={};function l(t,n=!1){let e=0,o=!1,i=!1,s=0,r=!1;const a=[];for(let c=0;c<t.length;c++){if(!0===i){i=!1;continue}const l=t[c];if("line"!==r)if("block"!==r)if("'"!==l){if(o)"\\"===l&&(i=!0);else if("{"!==l&&"["!==l)if("}"!==l&&"]"!==l){if(!(e>0))if(","!==l&&"\n"!==l){if(!(s<c))if(0!==l.trimEnd().length){if("/"===l){const n=t[c+1];if("/"===n){c++,r="line",s=c+1;continue}if("*"===n){c++,r="block",s=c+1;continue}}}else s=c+1}else{const n=t.slice(s,c).trimEnd();n.length>0&&a.push(n),s=c+1}}else{if(e--,e<0){const n=t.slice(s,c).trimEnd();n.length>0&&a.push(n);break}0===e&&(a.push(t.slice(s,c+1)),s=c+1)}else if(e++,1===e&&!n){const n=t.slice(s,c).trimEnd();n.length>0&&a.push(n),s=c}}else{if(!o){if(o=!0,0===e&&!n){const n=t.slice(s,c).trimEnd();n.length>0&&a.push(n),s=c}continue}o=!1,0===e&&(a.push(t.slice(s,c+1)),s=c+1)}else"*"===l&&"/"===t[c+1]&&(c++,r=!1),s=c+1;else"\n"===l&&(r=!1),s=c+1}if(!o&&0===e){const n=t.slice(s).trimEnd();n.length>0&&a.push(n)}return a}function f(t){if(0===(t=t.trimStart()).length)return;const n=t[0];return"'"===n?function(t){const n=[];let e=!1;for(const o of t)if(!0!==e)if("\\"!==o){if("'"===o)break;n.push(o)}else e=!0;else e=!1,"\\"!==o&&"'"!==o&&n.push("\\"),n.push(o);return n.join("")}(t.slice(1)):"["===n?function(t){const n=[];for(const e of l(t)){const t=f(e);if(void 0===t)return;n.push(t)}return n}(t.slice(1)):"{"===n?function(t){const n={};for(const e of l(t,!0)){const t=e.match(/^\s*([\w-]+)/);if(null===t){const t=f(e);if(void 0===t)return;n.__=t;continue}const o=t[1],i=t[0].length;let s=e.slice(i).trimEnd();if(0===s.length)n[o]=!0;else{const t=f(s);if(void 0===t)return;n[o]=t}}return n}(t.slice(1)):"true"===(t=t.trimEnd())||"false"!==t&&(/^(?:[+-]?Infinity|NaN|0x[\dA-Fa-f]+|0o[0-7]+|0b[01]+|[+-]?(?:\d*\.?\d+|\d+\.)(?:e[+-]?\d+)?)$/.test(t)?Number(t):/[\n\r',\[\]{}]/.test(t)?void 0:t)}function u(t){let n="div",e=[];const o={};for(const i in t){const s=t[i];if(void 0!==s)if("__"!==i)if(Array.isArray(s))n=i,e=p(s);else if("object"!=typeof s)o[i]=s;else{const{__:t}=s;if(void 0===t)continue;if("string"==typeof t){o[i]=p([{__:t}]);continue}if(!Array.isArray(t)){o[i]=p([t]);continue}o[i]=p(t)}else{if(n="katex",!Array.isArray(s)){e=p([s]);continue}e=p(s)}}return{tag:n,options:o,children:e}}function h(t){const n=[];for(const e of t)if("string"!=typeof e)"object"!=typeof e||Array.isArray(e)||n.push(u(e));else for(const t of e)t>=" "&&n.push(t);return n}function p(t){const n=[];for(const e of t)Array.isArray(e)?n.push(h(e)):n.push(h([e]));return n}function d(t){const n=f(`[${t}]`);if(Array.isArray(n))return p(n)}function g(t){return!t.startsWith("#")&&!/^[a-z][a-z0-9+.-]*:/i.test(t)}async function m(t,n,e=[]){const o=[];for(const i of t){const t=new URL(i,n);t.pathname.endsWith(".urls")||t.pathname.endsWith(".urls.txt")?e.includes(t.href)||o.push((async()=>{try{const n=await fetch(t.href);return n.ok?await b(await n.text(),t.href,e.concat(t.href)):[]}catch(t){return console.log(t),[]}})()):o.push(t.href)}return(await Promise.all(o)).flat()}async function b(t,n,e=[]){const o=f(`[${t}]`);if(!Array.isArray(o))return[];const i=[];for(const t of o)"string"==typeof t&&i.push(t);return await m(i,n,e)}function y(t){return x(t.children)}function T(t){let n="";for(const e of t)n+="string"!=typeof e?y(e):e;return n}function x(t){const n=[];for(const e of t)n.push(T(e));return n.join("\n")}function v(t){return w(t.children)}function I(t){let n="";for(const e of t)n+="string"!=typeof e?v(e):e;return n}function w(t){for(const n of t){const t=I(n);if(t.length>0)return t}return""}function S(t){for(const n of t)if(I(n).length>0)return n;return[]}function L(t){return Array.from(t.slice(0,100).matchAll(/[a-zA-Z0-9]+/g)).join("-").toLowerCase()}function A(t,n){for(;;){for(;null!==t.previousSibling;)t.previousSibling.remove();if(null===t.parentNode||t.parentNode===n)break;t=t.parentNode}}function O(t,n){for(;;){for(;null!==t.nextSibling;)t.nextSibling.remove();if(null===t.parentNode||t.parentNode===n)break;t=t.parentNode}}function C(t){return t.trim().split(/\s+/).map((t=>/^\d+$/.test(t)?Number(t):t.startsWith('"')?t.slice(1,-1):t))}function P(t){return t.map((t=>"number"==typeof t?t:/^\d+$/.test(t)?`'${t}'`:t)).join(" ")}function G(t,n,e){const o=[];if(0===n.length||0===e.length)return o;const i=n[0];if("number"!=typeof i)return o;let s=e[Math.min(i+t,e.length-1)];o.push(s);for(let t=1;t<n.length;t++){const e=n[t];if("number"==typeof e){if(Array.isArray(s)){const t=s[e];if("object"!=typeof t)break;o.push(s=t);continue}const t=s.children[e];if(void 0===t)break;o.push(s=t);continue}if(Array.isArray(s))break;const i=s.options[e];if(!Array.isArray(i))break;const r=n[++t];if("number"!=typeof r)break;const a=i[r];if(void 0===a)break;o.push(s=a)}return o}function U(t,n){const e=n[t];if(void 0===e)return[];const o=e.__;return void 0===o?[]:o.flat()}function k(t,n,e){const o=e[n];return void 0===o?[]:o[t]??[]}function E(t,n,e){const o=k(t,n,e),i=[];for(const t of o)"string"==typeof t&&i.push(t);return i}async function j(t,n,e){return await m(E(t,n,e),location.href)}function N(t,n,e){const o=k(t,n,e);if(0!==o.length)return o[o.length-1]}function M(t){const n=new Map;function e(t,o){for(const i of t){n.set(i,o);for(const t of i)if("string"!=typeof t){n.set(t,o);for(const n in t.options){const i=t.options[n];"object"==typeof i&&e(i,o)}e(t.children,o)}}}for(const n of t)e(n.value,n);return n}function $(t){const n=new Map;let e=0;for(const o of t)n.set(o,e),e+=o.value.length;return n}function _(t){const n=new Map;return function t(e,o){for(let i=0;i<e.length;i++){const s=e[i],r=o.concat(i);n.set(s,r);for(let e=0;e<s.length;e++){const o=s[e];if("string"==typeof o)continue;const i=r.concat(e);n.set(o,i);for(const n in o.options){const e=o.options[n];"object"==typeof e&&t(e,i.concat(n))}t(o.children,i)}}}(t,[]),n}function D(t,n,e){if(!g(t))return t;const o=e.get(n);if(void 0===o)return t;try{return new URL(t,o.url).href}catch(n){return console.log(n),t}}async function R(t,{builtInTagToUnitCompiler:n,style:e,headSTDN:o,footSTDN:i,root:s}={}){const r={},a={};void 0!==n&&Object.assign(a,n);const c=[],l=[],f=M(t),u=t.map((t=>t.value)).flat(),h=(o??[]).concat(u).concat(i??[]);for(const t of h){if(0===t.length)continue;const n=t[0];if("string"!=typeof n)if("global"!==n.tag){if(!0===n.options.global){let t=r[n.tag];void 0===t&&(r[n.tag]=t={}),void 0===t.__?t.__=[n.children]:t.__.push(n.children);for(const e in n.options){if("global"===e||"__"===e)continue;let o=n.options[e];if(void 0===o)continue;"string"==typeof o&&(e.endsWith("href")||e.endsWith("src"))&&g(o)&&(o=D(o,n,f));const i=t[e];void 0!==i?i.push(o):t[e]=[o]}}}else{const t=n.options.mod;"string"==typeof t&&(c.push(`https://cdn.jsdelivr.net/gh/st-mod/${t}/main.css`),l.push(`https://cdn.jsdelivr.net/gh/st-mod/${t}/ucs.js`));const e=n.options.css;"string"==typeof e&&c.push(`https://cdn.jsdelivr.net/gh/st-mod/${e}/main.css`);const o=n.options.ucs;"string"==typeof o&&l.push(`https://cdn.jsdelivr.net/gh/st-mod/${o}/ucs.js`);{const t=n.options["mod-gh"];"string"==typeof t&&(c.push(`https://cdn.jsdelivr.net/gh/${t}/main.css`),l.push(`https://cdn.jsdelivr.net/gh/${t}/ucs.js`))}{const t=n.options["css-gh"];"string"==typeof t&&c.push(`https://cdn.jsdelivr.net/gh/${t}/main.css`)}{const t=n.options["ucs-gh"];"string"==typeof t&&l.push(`https://cdn.jsdelivr.net/gh/${t}/ucs.js`)}{const t=n.options["css-src"];"string"==typeof t&&c.push(D(t,n,f))}{const t=n.options["ucs-src"];"string"==typeof t&&l.push(D(t,n,f))}}}const p=(await m(c,location.href)).map((t=>`@import ${JSON.stringify(t)};`)).join("");void 0!==e&&(e.textContent=p);for(const t of await m(l,location.href))try{Object.assign(a,await new Function(`return import(${JSON.stringify(t)})`)())}catch(t){console.log(t)}const d=new H(r);d.countSTDN(u);const b=_(u),y=$(t);return{css:p,fullSTDN:h,indexInfoArray:d.indexInfoArray,idToIndexInfo:d.idToIndexInfo,parts:t,partToOffset:y,stdn:u,tagToGlobalOptions:r,tagToUnitCompiler:a,title:d.title,unitToId:d.unitToId,unitOrLineToPart:f,unitOrLineToPosition:b,root:s,extractGlobalChildren:t=>U(t,r),extractGlobalOptionArray:(t,n)=>k(t,n,r),extractGlobalStrings:(t,n)=>E(t,n,r),extractGlobalURLs:(t,n)=>j(t,n,r),extractLastGlobalOption:(t,n)=>N(t,n,r),urlToAbsURL:(t,n)=>D(t,n,f)}}t.r(c),t.d(c,{Counter:()=>H});class H{constructor(t){this.tagToGlobalOptions=t,this.currentHeadingIndex=[],this.orbitToCurrentIndex={},this.baseIdToCount={},this.indexInfoArray=[],this.idToIndexInfo={},this.unitToId=new Map,this.title=""}createIndex(t,n){if("heading"===t){if(this.currentHeadingIndex.length<n)for(let t=this.currentHeadingIndex.length;t<n;t++)this.currentHeadingIndex.push(0);else{for(let t=n;t<this.currentHeadingIndex.length;t++)this.currentHeadingIndex[t]=0;for(const t in this.orbitToCurrentIndex){const e=this.orbitToCurrentIndex[t];if(!(void 0===e||e.length<n))for(let t=n;t<e.length;t++)e[t]=0}}return this.currentHeadingIndex[n-1]++,this.currentHeadingIndex.slice(0,n)}let e=this.orbitToCurrentIndex[t];if(void 0===e&&(e=[],this.orbitToCurrentIndex[t]=e),e.length<n)for(let t=e.length;t<n;t++)e.push(0);if(this.currentHeadingIndex.length<n-1)for(let t=this.currentHeadingIndex.length;t<n-1;t++)this.currentHeadingIndex.push(0);const o=this.currentHeadingIndex.slice(0,n-1);return o.push(++e[n-1]),o}countUnit(t){if("global"===t.tag||!0===t.options.global||!0===(t.options["no-count"]??N("no-count",t.tag,this.tagToGlobalOptions))||void 0!==this.unitToId.get(t))return;0===this.title.length&&"title"===t.tag&&(this.title=v(t));const n=L("string"==typeof t.options.id?t.options.id:v(t)),e=this.baseIdToCount[n]=(this.baseIdToCount[n]??0)+1,o=e>1||0===n.length?`${n}~${e}`:n;this.unitToId.set(t,o);let i=t.options.orbit??N("orbit",t.tag,this.tagToGlobalOptions);"string"==typeof i&&0!==i.length||(i="h1"===t.tag||"h2"===t.tag||"h3"===t.tag||"h4"===t.tag||"h5"===t.tag||"h6"===t.tag?"heading":t.tag);let s=t.options.level??N("level",t.tag,this.tagToGlobalOptions)??N("level",i,this.tagToGlobalOptions);if("number"!=typeof s||s<=0||s%1!=0)switch(t.tag){case"h2":s=2;break;case"h3":s=3;break;case"h4":s=4;break;case"h5":s=5;break;case"h6":s=6;break;default:s=1}const r={index:this.createIndex(i,s),id:o,orbit:i,unit:t};if(this.indexInfoArray.push(r),this.idToIndexInfo[o]=r,!0!==(t.options["no-count-inside"]??N("no-count-inside",t.tag,this.tagToGlobalOptions))){for(const n in t.options){const e=t.options[n];Array.isArray(e)&&this.countSTDN(e)}this.countSTDN(t.children)}}countSTDN(t){for(const n of t)for(const t of n)"string"!=typeof t&&this.countUnit(t)}}const W=["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","area","audio","img","map","track","video","iframe","del","ins","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],F=["a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","area","audio","img","map","track","video","iframe","del","ins","col","colgroup","table","tbody","tfoot","thead","tr"],B=["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","animate","animateMotion","animateTransform","circle","clipPath","defs","desc","ellipse","g","image","line","linearGradient","marker","mask","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","symbol","text","textPath","tspan","use"];function V(t){const n=document.createElement("span");return n.classList.add("unit","warn"),n.textContent=t,n}class q{constructor(t){this.context=t,this.ston=e,this.stdn=o,this.base=s,this.urls=i,this.position=r,this.counter=c,this.extractor=a,this.compile=z,this.supportedHTMLTags=W,this.supportedHTMLTagsWithInlineChildren=F,this.supportedSVGTags=B,this.createErrorElement=V,this.elementToUnitOrLine=new Map,this.unitOrLineToElements=new Map,this.unitToCompiling=new Map}registerElement(t,n){this.elementToUnitOrLine.set(t,n);let e=this.unitOrLineToElements.get(n);void 0===e&&this.unitOrLineToElements.set(n,e=[]),e.push(t)}async compileUnit(t){if(!0===this.unitToCompiling.get(t)){const n=this.createErrorElement("Loop");return this.registerElement(n,t),n}if("global"===t.tag||!0===t.options.global){const n=document.createElement("div");return n.classList.add("unit","global"),this.registerElement(n,t),n}this.unitToCompiling.set(t,!0);let n=t.options["compile-with"]??N("compile-with",t.tag,this.context.tagToGlobalOptions);"string"==typeof n&&0!==n.length||(n=t.tag);const e=this.context.tagToUnitCompiler[n];let o;if(void 0!==e){try{o=await e(t,this)}catch(t){console.log(t),o=this.createErrorElement("Broken")}if(o.classList.contains("unit")&&o.classList.contains("warn"))return this.registerElement(o,t),this.unitToCompiling.set(t,!1),o}else W.includes(n)?(o=document.createElement(n),F.includes(n)?o.append(await this.compileInlineSTDN(t.children)):o.append(await this.compileSTDN(t.children))):B.includes(n)?(o=document.createElementNS("http://www.w3.org/2000/svg",n),o.append(await this.compileInlineSTDN(t.children))):(o=document.createElement("div"),o.append(await this.compileSTDN(t.children)));o.classList.add("unit");try{o.classList.add(n),"string"==typeof t.options.class&&o.classList.add(...t.options.class.trim().split(/\s+/));for(const n of k("class",t.tag,this.context.tagToGlobalOptions))"string"==typeof n&&o.classList.add(...n.trim().split(/\s+/))}catch(t){console.log(t)}const i=[];let s=o.getAttribute("style");null!==s&&i.push(s),"string"==typeof t.options.style&&i.push(t.options.style);for(const n of k("style",t.tag,this.context.tagToGlobalOptions))"string"==typeof n&&i.push(n);if(i.length>0)try{o.setAttribute("style",i.join("; "))}catch(t){console.log(t)}const r=this.context.unitToId.get(t);void 0!==r&&(o.id=r);for(const n in t.options){if("id"===n||"class"===n||"style"===n)continue;if(o.hasAttribute(n))continue;let e=t.options[n];if(!0===e?e="":"number"==typeof e&&(e=e.toString()),"string"==typeof e){(n.endsWith("href")||n.endsWith("src"))&&g(e)&&(e=this.context.urlToAbsURL(e,t));try{o.setAttribute(n,e)}catch(t){console.log(t)}}}return this.registerElement(o,t),this.unitToCompiling.set(t,!1),o}async compileInline(t){return"string"!=typeof t?await this.compileUnit(t):new Text(t)}async compileLine(t){const n=new DocumentFragment;for(const e of t)n.append(await this.compileInline(e));return n}async compileInlineSTDN(t){const n=new DocumentFragment;for(let e=0;e<t.length;e++)n.append(await this.compileLine(t[e])),e!==t.length-1&&n.append(new Text("\n"));return n}async compileSTDN(t){const n=new DocumentFragment;for(const e of t){const t=document.createElement("div");t.classList.add("st-line"),n.append(t),t.append(await this.compileLine(e)),this.registerElement(t,e)}return n}}async function z(t,n={}){const e=[];for(const{value:n,url:o}of t){const t=d(n);void 0!==t&&e.push({value:t,url:o})}const o=await R(e,n),i=new q(o);return{compiler:i,documentFragment:await i.compileSTDN(o.stdn)}}async function X(t,n={}){const e=[];for(const n of await m(t,location.href))e.push((async()=>{try{const t=await fetch(n);return t.ok?[{value:await t.text(),url:n}]:[]}catch(t){return console.log(t),[]}})());return await z((await Promise.all(e)).flat(),n)}var Y=n.Si,J=n.AT,K=n.MY,Z=n.yd,Q=n.h8,tt=n.l7,nt=n.gh,et=n.Rs,ot=n.t$,it=n.aV,st=n.XY,rt=n.kC,at=n.Ws,ct=n.fK,lt=n.wS,ft=n.Xg,ut=n.TA,ht=n.f2,pt=n.ow,dt=n.yr,gt=n.dG,mt=n.tC,bt=n.TW,yt=n.q0,Tt=n.xU,xt=n.yB,vt=n._C,It=n.lV,wt=n.$P,St=n.Iz,Lt=n.c4,At=n.od,Ot=n.dt,Ct=n.FW;export{Y as Compiler,J as Counter,K as compile,Z as compileURLs,Q as createErrorElement,tt as extractContext,nt as extractGlobalChildren,et as extractGlobalOptionArray,ot as extractGlobalStrings,it as extractGlobalURLs,st as extractLastGlobalOption,rt as extractPartToOffset,at as extractUnitOrLineToPart,ct as extractUnitOrLineToPosition,lt as isRelURL,ft as lineToInlinePlainString,ut as lineToPlainString,ht as parsePositionStr,pt as positionToUnitOrLines,dt as removeAfter,gt as removeBefore,mt as stdnToInlinePlainString,bt as stdnToInlinePlainStringLine,yt as stdnToPlainString,Tt as stringToId,xt as stringifyPosition,vt as supportedHTMLTags,It as supportedHTMLTagsWithInlineChildren,wt as supportedSVGTags,St as unitToInlinePlainString,Lt as unitToPlainString,At as urlToAbsURL,Ot as urlsStrToAbsURLs,Ct as urlsToAbsURLs};