var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.d(e,{Si:()=>et,AT:()=>K,MY:()=>nt,yd:()=>it,h8:()=>tt,l7:()=>Y,gh:()=>H,Rs:()=>q,t$:()=>M,aV:()=>F,XY:()=>R,kC:()=>X,Ws:()=>V,fK:()=>z,wS:()=>$,Xg:()=>P,TA:()=>k,tC:()=>W,q0:()=>D,xU:()=>G,On:()=>Q,_C:()=>B,lV:()=>J,$P:()=>Z,Iz:()=>N,c4:()=>E,dt:()=>_,FW:()=>U});var n={};t.r(n),t.d(n,{parse:()=>d,parseWithIndex:()=>f,stringify:()=>p,stringifyWithComment:()=>g});var i={};t.r(i),t.d(i,{format:()=>C,parse:()=>w,parseWithIndex:()=>S,stringify:()=>L});var o={};t.r(o),t.d(o,{isRelURL:()=>$,urlsStrToAbsURLs:()=>_,urlsToAbsURLs:()=>U});var s={};t.r(s),t.d(s,{lineToInlinePlainString:()=>P,lineToPlainString:()=>k,stdnToInlinePlainString:()=>W,stdnToPlainString:()=>D,stringToId:()=>G,unitToInlinePlainString:()=>N,unitToPlainString:()=>E});var r={};t.r(r),t.d(r,{extractContext:()=>Y,extractGlobalChildren:()=>H,extractGlobalOptionArray:()=>q,extractGlobalStrings:()=>M,extractGlobalURLs:()=>F,extractLastGlobalOption:()=>R,extractPartToOffset:()=>X,extractUnitOrLineToPart:()=>V,extractUnitOrLineToPosition:()=>z});var a={};function c(t,e=!1){let n=0,i=!1,o=!1,s=0,r=!1;const a=[];for(let c=0;c<t.length;c++){if(!0===o){o=!1;continue}const l=t[c];if("line"!==r)if("block"!==r)if("'"!==l){if(i)"\\"===l&&(o=!0);else if("{"!==l&&"["!==l)if("}"!==l&&"]"!==l){if(!(n>0))if(","!==l&&"\n"!==l){if(!(s<c))if(0!==l.trimEnd().length){if("/"===l){const e=t[c+1];if("/"===e){c++,r="line",s=c+1;continue}if("*"===e){c++,r="block",s=c+1;continue}}}else s=c+1}else{const e=t.slice(s,c).trimEnd();e.length>0&&a.push(e),s=c+1}}else{if(n--,n<0){const e=t.slice(s,c).trimEnd();e.length>0&&a.push(e);break}0===n&&(a.push(t.slice(s,c+1)),s=c+1)}else if(n++,1===n&&!e){const e=t.slice(s,c).trimEnd();e.length>0&&a.push(e),s=c}}else{if(!i){if(i=!0,0===n&&!e){const e=t.slice(s,c).trimEnd();e.length>0&&a.push(e),s=c}continue}i=!1,0===n&&(a.push(t.slice(s,c+1)),s=c+1)}else"*"===l&&"/"===t[c+1]&&(c++,r=!1),s=c+1;else"\n"===l&&(r=!1),s=c+1}if(!i&&0===n){const e=t.slice(s).trimEnd();e.length>0&&a.push(e)}return a}function l(t,e,n=!1){let i=0,o=!1,s=!1,r=0,a=!1,c=[];const l=[];for(let u=0;u<t.length;u++){if(!0===s){s=!1;continue}const d=t[u];if("line"!==a)if("block"!==a)if("'"!==d){if(o)"\\"===d&&(s=!0);else if("{"!==d&&"["!==d)if("}"!==d&&"]"!==d){if(!(i>0))if(","!==d&&"\n"!==d){if(!(r<u))if(0!==d.trimEnd().length){if("/"===d){const e=t[u+1];if("/"===e){r=u,u++,a="line";continue}if("*"===e){r=u,u++,a="block";continue}}}else r=u+1}else{const n=t.slice(r,u).trimEnd();n.length>0&&(l.push({value:n,index:e+r,comment:c.join("\n")}),c=[]),r=u+1}}else{if(i--,i<0){const n=t.slice(r,u).trimEnd();n.length>0&&(l.push({value:n,index:e+r,comment:c.join("\n")}),c=[]);break}0===i&&(l.push({value:t.slice(r,u+1),index:e+r,comment:c.join("\n")}),c=[],r=u+1)}else if(i++,1===i&&!n){const n=t.slice(r,u).trimEnd();n.length>0&&(l.push({value:n,index:e+r,comment:c.join("\n")}),c=[]),r=u}}else{if(!o){if(o=!0,0===i&&!n){const n=t.slice(r,u).trimEnd();n.length>0&&(l.push({value:n,index:e+r,comment:c.join("\n")}),c=[]),r=u}continue}o=!1,0===i&&(l.push({value:t.slice(r,u+1),index:e+r,comment:c.join("\n")}),c=[],r=u+1)}else"*"===d&&"/"===t[u+1]&&(u++,a=!1,c.push(t.slice(r,u+1).replace(/\n[ ]*/g,"\n ")),r=u+1);else"\n"===d&&(a=!1,c.push(t.slice(r,u).trimEnd()),r=u+1)}if(!o&&0===i&&!1===a){const n=t.slice(r).trimEnd();n.length>0&&l.push({value:n,index:e+r,comment:c.join("\n")})}return l}function u(t){const e=[];let n=!1;for(const i of t)if(!0!==n)if("\\"!==i){if("'"===i)break;e.push(i)}else n=!0;else n=!1,"\\"!==i&&"'"!==i&&e.push("\\"),e.push(i);return e.join("")}function d(t){if(0===(t=t.trimStart()).length)return;const e=t[0];return"'"===e?u(t.slice(1)):"["===e?function(t){const e=[];for(const n of c(t)){const t=d(n);if(void 0===t)return;e.push(t)}return e}(t.slice(1)):"{"===e?function(t){const e={};for(const n of c(t,!0)){const t=n.match(/^\s*([\w-]+)/);if(null===t){const t=d(n);if(void 0===t)return;e.__=t;continue}const i=t[1],o=t[0].length;let s=n.slice(o).trimEnd();if(0===s.length)e[i]=!0;else{const t=d(s);if(void 0===t)return;e[i]=t}}return e}(t.slice(1)):"true"===(t=t.trimEnd())||"false"!==t&&(/^(?:[+-]?Infinity|NaN|0x[\da-fA-F]+|0o[0-7]+|0b[01]+|[+-]?(?:\d*\.?\d+|\d+\.)(?:e[+-]?\d+)?)$/.test(t)?Number(t):/[',{}\[\]\n\r]/.test(t)?void 0:t)}function f(t,e=0,n=""){e+=t.length;const i=function(t,e){if(0===t.length)return;const n=t[0];return"'"===n?u(t.slice(1)):"["===n?function(t,e){const n=[];for(const{value:i,index:o,comment:s}of l(t,e)){const t=f(i,o,s);if(void 0===t)return;n.push(t)}return n}(t.slice(1),e+1):"{"===n?function(t,e){const n={};for(const{value:i,index:o,comment:s}of l(t,e,!0)){const t=i.match(/^\s*([\w-]+)/);if(null===t){const t=f(i,o,s);if(void 0===t)return;n.__=t;continue}const e=t[1],r=t[0].length;let a=i.slice(r).trimEnd();if(0===a.length)n[e]={value:!0,index:o+r,comment:s};else{const t=f(a,o+r,s);if(void 0===t)return;n[e]=t}}return n}(t.slice(1),e+1):"true"===(t=t.trimEnd())||"false"!==t&&(/^(?:[+-]?Infinity|NaN|0x[\da-fA-F]+|0o[0-7]+|0b[01]+|[+-]?(?:\d*\.?\d+|\d+\.)(?:e[+-]?\d+)?)$/.test(t)?Number(t):/[',{}\[\]\n\r]/.test(t)?void 0:t)}(t=t.trimStart(),e-=t.length);if(void 0!==i)return{value:i,index:e,comment:n}}function h(t,e){if(e&&t.length>0&&t[0].trim().length>0&&(1===t.length||t[t.length-1].trim().length>0)&&!/[',{}\[\]\n\r]/.test(t)&&"true"!==t&&"false"!==t&&!/^(?:[+-]?Infinity|NaN|0x[\da-fA-F]+|0o[0-7]+|0b[01]+|[+-]?(?:\d*\.?\d+|\d+\.)(?:e[+-]?\d+)?)$/.test(t)&&!t.startsWith("//")&&!t.startsWith("/*"))return t;const n=["'"];for(let e=0;e<t.length;e++){const i=t[e];if("\\"!==i)"'"!==i?n.push(i):n.push("\\'");else{if(e===t.length-1){n.push("\\\\");break}const o=t[e+1];if("\\"===o||"'"===o){n.push("\\\\");continue}n.push(i)}}return n.push("'"),n.join("")}function p(t,e={}){return Array.isArray(t)?function(t,{addDecorativeComma:e,addDecorativeSpace:n,indentLevel:i,indentTarget:o,useUnquotedString:s}){o=o??"none",i=i??0,e=e??"never";const r=[],a=t.length>1&&("all"===o||"array"===o||"arrayInObjectAndThis"===o),c=i+(a?1:0);"arrayInObjectAndThis"===o&&(o="arrayInObject");const l="always"===n||"afterComma"===n?", ":",";let u;for(let i=0;i<t.length;i++){let d;d=void 0===u?p(t[i],{indentTarget:o,indentLevel:c,addDecorativeComma:e,addDecorativeSpace:n,useUnquotedString:s}):u,i!==t.length-1&&(u=p(t[i+1],{indentTarget:o,indentLevel:c,addDecorativeComma:e,addDecorativeSpace:n,useUnquotedString:s})),a||i===t.length-1||"always"!==e&&(d.endsWith("'")||d.endsWith("}")||d.endsWith("]")||void 0!==u&&(u.endsWith("'")||u.endsWith("}")||u.endsWith("]")))?r.push(d):r.push(d+l)}if(a){let t="\n";for(let e=0;e<i;e++)t+="    ";let e=t;return i>=0&&(e+="    "),`[${e}${r.join(e)}${t}]`}return`[${r.join("")}]`}(t,e):"object"==typeof t?function(t,{addDecorativeComma:e,addDecorativeSpace:n,indentLevel:i,indentTarget:o,useUnquotedString:s}){o=o??"none",i=i??0,e=e??"never";const r=[],a=Object.keys(t),c=a.length>1&&("all"===o||"object"===o),l=i+(c?1:0);"arrayInObject"===o&&(o="arrayInObjectAndThis");const u="always"===n||"afterComma"===n?", ":",",d="always"===n||"afterKey"===n?" ":"";for(let i=0;i<a.length;i++){const f=a[i];if(null===f.match(/^[\w-]+$/))continue;const h=t[f];if(void 0===h)continue;const g=p(h,{indentTarget:o,indentLevel:l,addDecorativeComma:e,addDecorativeSpace:n,useUnquotedString:"__"===f&&"string"==typeof h?void 0:s});g.startsWith("'")||g.startsWith("[")||g.startsWith("{")?c||i===a.length-1||"always"!==e&&"inObject"!==e?r.push(("__"===f?"":f+d)+g):r.push(("__"===f?"":f+d)+g+u):"true"===g?c||i===a.length-1?r.push(f):r.push(f+u):c||i===a.length-1?r.push(`${f} ${g}`):r.push(`${f} ${g}${u}`)}if(c){let t="\n";for(let e=0;e<i;e++)t+="    ";let e=t;return i>=0&&(e+="    "),`{${e}${r.join(e)}${t}}'`}return`{${r.join("")}}`}(t,e):"number"==typeof t?t.toString():"string"==typeof t?h(t,e.useUnquotedString):!0===t?"true":!1===t?"false":""}function g(t,e={}){return Array.isArray(t)?function(t,{addDecorativeComma:e,addDecorativeSpace:n,indentLevel:i,indentTarget:o,useUnquotedString:s}){o=o??"none",i=i??0,e=e??"never";const r=[],a=t.length>1&&("all"===o||"array"===o||"arrayInObjectAndThis"===o)||void 0!==t.find((t=>t.comment.length>0)),c=i+(a?1:0);"arrayInObjectAndThis"===o&&(o="arrayInObject");const l="always"===n||"afterComma"===n?", ":",";let u;for(let i=0;i<t.length;i++){const{value:d,comment:f}=t[i];let h;h=void 0===u?g(d,{indentTarget:o,indentLevel:c,addDecorativeComma:e,addDecorativeSpace:n,useUnquotedString:s}):u,i!==t.length-1&&(u=g(t[i+1].value,{indentTarget:o,indentLevel:c,addDecorativeComma:e,addDecorativeSpace:n,useUnquotedString:s})),a||i===t.length-1||"always"!==e&&(h.endsWith("'")||h.endsWith("}")||h.endsWith("]")||void 0!==u&&(u.endsWith("'")||u.endsWith("}")||u.endsWith("]")))?(f.length>0&&r.push(...f.split("\n")),r.push(h)):r.push(h+l)}if(a){let t="\n";for(let e=0;e<i;e++)t+="    ";let e=t;return i>=0&&(e+="    "),`[${e}${r.join(e)}${t}]`}return`[${r.join("")}]`}(t,e):"object"==typeof t?function(t,{addDecorativeComma:e,addDecorativeSpace:n,indentLevel:i,indentTarget:o,useUnquotedString:s}){o=o??"none",i=i??0,e=e??"never";const r=[],a=Object.keys(t);let c=a.length>1&&("all"===o||"object"===o);if(!c)for(const e of a){const n=t[e];if(void 0!==n&&n.comment.length>0){c=!0;break}}const l=i+(c?1:0);"arrayInObject"===o&&(o="arrayInObjectAndThis");const u="always"===n||"afterComma"===n?", ":",",d="always"===n||"afterKey"===n?" ":"";for(let i=0;i<a.length;i++){const f=a[i];if(null===f.match(/^[\w-]+$/))continue;const h=t[f];if(void 0===h)continue;const{value:p,comment:m}=h,y=g(p,{indentTarget:o,indentLevel:l,addDecorativeComma:e,addDecorativeSpace:n,useUnquotedString:"__"===f&&"string"==typeof p?void 0:s});m.length>0&&r.push(...m.split("\n")),y.startsWith("'")||y.startsWith("[")||y.startsWith("{")?c||i===a.length-1||"always"!==e&&"inObject"!==e?r.push(("__"===f?"":f+d)+y):r.push(("__"===f?"":f+d)+y+u):"true"===y?c||i===a.length-1?r.push(f):r.push(f+u):c||i===a.length-1?r.push(`${f} ${y}`):r.push(`${f} ${y}${u}`)}if(c){let t="\n";for(let e=0;e<i;e++)t+="    ";let e=t;return i>=0&&(e+="    "),`{${e}${r.join(e)}${t}}`}return`{${r.join("")}}`}(t,e):"string"==typeof t?h(t,e.useUnquotedString):"number"==typeof t?t.toString():!0===t?"true":!1===t?"false":""}function m(t){let e="div",n=[];const i={};for(const o in t){const s=t[o];if(void 0!==s)if("__"!==o)if(Array.isArray(s))e=o,n=T(s);else if("object"!=typeof s)i[o]=s;else{const{__:t}=s;if(void 0===t)continue;if("string"==typeof t){i[o]=T([{__:t}]);continue}if(!Array.isArray(t)){i[o]=T([t]);continue}i[o]=T(t)}else{if(e="katex",!Array.isArray(s)){n=T([s]);continue}n=T(s)}}return{tag:e,options:i,children:n}}function y(t,e){let n="div";const i={value:[],index:e,comment:""},o={value:{},index:e,comment:""};for(const e in t){let s=t[e];if(void 0===s)continue;const{value:r,index:a,comment:c}=s;if("__"!==e)if(Array.isArray(r))n=e,i.value=x(r,a),i.index=a,i.comment=c;else if("object"!=typeof r)o.value[e]={value:r,index:a,comment:c};else{const{__:t}=r;if(void 0===t)continue;if("string"==typeof t.value){o.value[e]={value:x([{value:{__:t},index:a,comment:""}],a),index:a,comment:c};continue}if(!Array.isArray(t.value)){o.value[e]={value:x([t],a),index:a,comment:c};continue}o.value[e]={value:x(t.value,a),index:a,comment:c}}else{if(n="katex",i.index=a,!Array.isArray(r)){i.value=x([s],a);continue}i.value=x(r,a),i.comment=c}}return{tag:{value:n,index:e,comment:""},options:o,children:i}}function v(t){const e=[];for(const n of t)if("string"!=typeof n)"object"!=typeof n||Array.isArray(n)||e.push(m(n));else for(const t of n)t>=" "&&e.push(t);return e}function b(t){const e=[];for(const{value:n,index:i,comment:o}of t)if("string"!=typeof n)"object"!=typeof n||Array.isArray(n)||e.push({value:y(n,i),index:i,comment:o});else for(const t of n)t>=" "&&e.push({value:t,index:i,comment:""});return e}function T(t){const e=[];for(const n of t)Array.isArray(n)?e.push(v(n)):e.push(v([n]));return e}function x(t,e){const n=[];for(const i of t)Array.isArray(i.value)?n.push({value:b(i.value),index:i.index,comment:i.comment}):n.push({value:b([i]),index:e,comment:""});return n}function w(t){const e=d(`[${t}]`);if(Array.isArray(e))return T(e)}function S(t){const e=f(`[${t}]`);if(void 0!==e&&Array.isArray(e.value))return{value:x(e.value,e.index),index:e.index,comment:e.comment}}function I(t){const e={},{tag:n,children:i,options:o}=t;for(const t in o){let n=o[t];e[t]="object"==typeof n?{__:O(n)}:n}return"katex"===n?e.__=function(t){const e=A(t);if(1===e.length){const t=e[0];if("string"==typeof t)return t}return e}(i):("div"!==n||i.length>0)&&(e[n]=A(i)),e}function j(t){const e=[];let n="";for(const i of t)"object"!=typeof i?n+=i:(n.length>0&&(e.push(n),n=""),e.push(I(i)));return n.length>0&&e.push(n),1===e.length?e[0]:e}function A(t){const e=[];for(const n of t)e.push(j(n));return e}function O(t){const e=A(t);if(1===e.length){const t=e[0];if("object"==typeof t&&!Array.isArray(t)){const e=Object.keys(t);if(1===e.length&&"__"===e[0]){const{__:e}=t;if("string"==typeof e)return e}}}return e}function L(t){return void 0===t?"":t.length<2?p(A(t),{indentTarget:"arrayInObjectAndThis",addDecorativeComma:"inObject",addDecorativeSpace:"always",useUnquotedString:!0}).slice(1,-1).trim():p(A(t),{indentLevel:-1,indentTarget:"arrayInObjectAndThis",addDecorativeComma:"inObject",addDecorativeSpace:"always",useUnquotedString:!0}).slice(1,-1).trim()}function C(t){const e=f(`[${t}]`);return void 0!==e&&Array.isArray(e.value)?e.value.length<2?g(e.value,{indentTarget:"arrayInObjectAndThis",addDecorativeComma:"inObject",addDecorativeSpace:"always",useUnquotedString:!0}).slice(1,-1).trim():g(e.value,{indentLevel:-1,indentTarget:"arrayInObjectAndThis",addDecorativeComma:"inObject",addDecorativeSpace:"always",useUnquotedString:!0}).slice(1,-1).trim():t}function $(t){return!t.startsWith("#")&&!/^[a-z][a-z0-9+.-]*:/i.test(t)}async function U(t,e,n=[]){const i=[];for(const o of t){const t=new URL(o,e);t.pathname.endsWith(".urls")||t.pathname.endsWith(".urls.txt")?n.includes(t.href)||i.push((async()=>{try{const e=await fetch(t.href);return e.ok?await _(await e.text(),t.href,n.concat(t.href)):[]}catch(t){return console.log(t),[]}})()):i.push(t.href)}return(await Promise.all(i)).flat()}async function _(t,e,n=[]){const i=d(`[${t}]`);if(!Array.isArray(i))return[];const o=[];for(const t of i)"string"==typeof t&&o.push(t);return await U(o,e,n)}function D(t){const e=[];for(const n of t)e.push(k(n));return e.join("\n")}function k(t){let e="";for(const n of t)e+="string"!=typeof n?E(n):n;return e}function E(t){return D(t.children)}function W(t){for(const e of t){const t=P(e);if(t.length>0)return t}return""}function P(t){let e="";for(const n of t)e+="string"!=typeof n?N(n):n;return e}function N(t){return W(t.children)}function G(t){return Array.from(t.slice(0,100).matchAll(/[a-zA-Z0-9]+/g)).join("-").toLowerCase()}function q(t,e,n){const i=n[e];return void 0===i?[]:i[t]??[]}function R(t,e,n){const i=q(t,e,n);if(0!==i.length)return i[i.length-1]}function H(t,e){const n=e[t];if(void 0===n)return[];const i=n.__;return void 0===i?[]:i.flat()}function M(t,e,n){const i=q(t,e,n),o=[];for(const t of i)"string"==typeof t&&o.push(t);return o}async function F(t,e,n){return await U(M(t,e,n),location.href)}function V(t){const e=new Map;function n(t,i){for(const o of t){e.set(o,i);for(const t of o)if("string"!=typeof t){e.set(t,i);for(const e in t.options){const o=t.options[e];"object"==typeof o&&n(o,i)}n(t.children,i)}}}for(const e of t)n(e.value,e);return e}function z(t){const e=new Map;return function t(n,i){for(let o=0;o<n.length;o++){const s=n[o],r=i.concat(o);e.set(s,r);for(let n=0;n<s.length;n++){const i=s[n];if("string"==typeof i)continue;const o=r.concat(n);e.set(i,o);for(const e in i.options){const n=i.options[e];"object"==typeof n&&t(n,o.concat(e))}t(i.children,o)}}}(t,[]),e}function X(t){const e=new Map;let n=0;for(const i of t)e.set(i,n),n+=i.value.length;return e}async function Y(t,{builtInTagToUnitCompiler:e,style:n,headSTDN:i,footSTDN:o,root:s}={}){const r={},a={};void 0!==e&&Object.assign(a,e);const c=[],l=[],u=V(t),d=t.map((t=>t.value)).flat(),f=(i??[]).concat(d).concat(o??[]);function h(t,e){if(!$(t))return t;const n=u.get(e);if(void 0===n)return t;try{return new URL(t,n.url).href}catch(e){return console.log(e),t}}for(const t of f){if(0===t.length)continue;const e=t[0];if("string"!=typeof e)if("global"!==e.tag){if(!0===e.options.global){let t=r[e.tag];void 0===t&&(r[e.tag]=t={}),void 0===t.__?t.__=[e.children]:t.__.push(e.children);for(const n in e.options){if("global"===n||"__"===n)continue;let i=e.options[n];if(void 0===i)continue;"string"==typeof i&&(n.endsWith("href")||n.endsWith("src"))&&$(i)&&(i=h(i,e));const o=t[n];void 0!==o?o.push(i):t[n]=[i]}}}else{const t=e.options.mod;"string"==typeof t&&(c.push(`https://cdn.jsdelivr.net/gh/st-mod/${t}/main.css`),l.push(`https://cdn.jsdelivr.net/gh/st-mod/${t}/ucs.js`));const n=e.options.css;"string"==typeof n&&c.push(`https://cdn.jsdelivr.net/gh/st-mod/${n}/main.css`);const i=e.options.ucs;"string"==typeof i&&l.push(`https://cdn.jsdelivr.net/gh/st-mod/${i}/ucs.js`);{const t=e.options["mod-gh"];"string"==typeof t&&(c.push(`https://cdn.jsdelivr.net/gh/${t}/main.css`),l.push(`https://cdn.jsdelivr.net/gh/${t}/ucs.js`))}{const t=e.options["css-gh"];"string"==typeof t&&c.push(`https://cdn.jsdelivr.net/gh/${t}/main.css`)}{const t=e.options["ucs-gh"];"string"==typeof t&&l.push(`https://cdn.jsdelivr.net/gh/${t}/ucs.js`)}{const t=e.options["css-src"];"string"==typeof t&&c.push(h(t,e))}{const t=e.options["ucs-src"];"string"==typeof t&&l.push(h(t,e))}}}const p=(await U(c,location.href)).map((t=>`@import ${JSON.stringify(t)};`)).join("");void 0!==n&&(n.textContent=p);for(const t of await U(l,location.href))try{Object.assign(a,await new Function(`return import(${JSON.stringify(t)})`)())}catch(t){console.log(t)}const g=new K(r);g.countSTDN(d);const m=z(d),y=X(t);return{css:p,fullSTDN:f,indexInfoArray:g.indexInfoArray,idToIndexInfo:g.idToIndexInfo,parts:t,partToOffset:y,stdn:d,tagToGlobalOptions:r,tagToUnitCompiler:a,title:g.title,unitToId:g.unitToId,unitOrLineToPart:u,unitOrLineToPosition:m,urlToAbsURL:h,root:s}}t.r(a),t.d(a,{Counter:()=>K});class K{constructor(t){this.tagToGlobalOptions=t,this.currentHeadingIndex=[],this.orbitToCurrentIndex={},this.baseIdToCount={},this.indexInfoArray=[],this.idToIndexInfo={},this.unitToId=new Map,this.title=""}createIndex(t,e){if("heading"===t){if(this.currentHeadingIndex.length<e)for(let t=this.currentHeadingIndex.length;t<e;t++)this.currentHeadingIndex.push(0);else{for(let t=e;t<this.currentHeadingIndex.length;t++)this.currentHeadingIndex[t]=0;for(const t in this.orbitToCurrentIndex){const n=this.orbitToCurrentIndex[t];if(!(void 0===n||n.length<e))for(let t=e;t<n.length;t++)n[t]=0}}return this.currentHeadingIndex[e-1]++,this.currentHeadingIndex.slice(0,e)}let n=this.orbitToCurrentIndex[t];if(void 0===n&&(n=[],this.orbitToCurrentIndex[t]=n),n.length<e)for(let t=n.length;t<e;t++)n.push(0);if(this.currentHeadingIndex.length<e-1)for(let t=this.currentHeadingIndex.length;t<e-1;t++)this.currentHeadingIndex.push(0);const i=this.currentHeadingIndex.slice(0,e-1);return i.push(++n[e-1]),i}countUnit(t){if("global"===t.tag||!0===t.options.global||!0===(t.options["no-count"]??R("no-count",t.tag,this.tagToGlobalOptions))||void 0!==this.unitToId.get(t))return;0===this.title.length&&"title"===t.tag&&(this.title=N(t));const e=G("string"==typeof t.options.id?t.options.id:N(t)),n=this.baseIdToCount[e]=(this.baseIdToCount[e]??0)+1,i=n>1||0===e.length?`${e}~${n}`:e;this.unitToId.set(t,i);let o=t.options.orbit??R("orbit",t.tag,this.tagToGlobalOptions);"string"==typeof o&&0!==o.length||(o="h1"===t.tag||"h2"===t.tag||"h3"===t.tag||"h4"===t.tag||"h5"===t.tag||"h6"===t.tag?"heading":t.tag);let s=t.options.level??R("level",t.tag,this.tagToGlobalOptions)??R("level",o,this.tagToGlobalOptions);if("number"!=typeof s||s<=0||s%1!=0)switch(t.tag){case"h2":s=2;break;case"h3":s=3;break;case"h4":s=4;break;case"h5":s=5;break;case"h6":s=6;break;default:s=1}const r={index:this.createIndex(o,s),id:i,orbit:o,unit:t};if(this.indexInfoArray.push(r),this.idToIndexInfo[i]=r,!0!==(t.options["no-count-inside"]??R("no-count-inside",t.tag,this.tagToGlobalOptions))){for(const e in t.options){const n=t.options[e];Array.isArray(n)&&this.countSTDN(n)}this.countSTDN(t.children)}}countSTDN(t){for(const e of t)for(const t of e)"string"!=typeof t&&this.countUnit(t)}}const B=["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","area","audio","img","map","track","video","iframe","del","ins","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],J=["a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","area","audio","img","map","track","video","iframe","del","ins","col","colgroup","table","tbody","tfoot","thead","tr"],Z=["animate","animateMotion","animateTransform","circle","clipPath","defs","desc","ellipse","g","image","line","marker","mask","mpath","path","pattern","polygon","polyline","rect","svg","symbol","text","textPath","tspan","use"],Q=["accesskey","align","allow","alt","autoplay","cite","class","cols","colspan","controls","coords","crossorigin","datetime","decoding","default","dir","download","draggable","for","headers","href","hreflang","id","kind","label","lang","loop","muted","name","open","ping","poster","preload","referrerpolicy","rel","reversed","rows","rowspan","sandbox","scope","span","spellcheck","src","srcdoc","srclang","srcset","start","style","tabindex","target","title","translate","usemap","value","begin","dur","end","min","max","restart","repeatCount","repeatDur","fill","calcMode","values","keyTimes","keySplines","from","to","by","attributeName","additive","accumulate","clipPathUnits","crossorigin","d","dx","dy","height","href","keyPoints","lengthAdjust","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","method","orient","path","pathLength","patternContentUnits","patternTransform","patternUnits","points","preserveAspectRatio","refX","refY","rotate","side","spacing","startOffset","textLength","type","viewBox","width","x","x1","x2","y","y1","y2"];function tt(t){const e=document.createElement("span");return e.classList.add("unit","warn"),e.textContent=t,e}class et{constructor(t){this.context=t,this.ston=n,this.stdn=i,this.base=s,this.urls=o,this.counter=a,this.extractor=r,this.compile=nt,this.supportedHTMLTags=B,this.supportedHTMLTagsWithInlineChildren=J,this.supportedSVGTags=Z,this.supportedAttributes=Q,this.createErrorElement=tt,this.elementToUnitOrLine=new Map,this.unitOrLineToElements=new Map,this.unitToCompiling=new Map}registerElement(t,e){this.elementToUnitOrLine.set(t,e);let n=this.unitOrLineToElements.get(e);void 0===n&&this.unitOrLineToElements.set(e,n=[]),n.push(t)}async compileUnit(t){if(!0===this.unitToCompiling.get(t)){const e=this.createErrorElement("Loop");return this.registerElement(e,t),e}if("global"===t.tag||!0===t.options.global){const e=document.createElement("div");return e.classList.add("unit","global"),this.registerElement(e,t),e}this.unitToCompiling.set(t,!0);let e=t.options["compile-with"]??R("compile-with",t.tag,this.context.tagToGlobalOptions);"string"==typeof e&&0!==e.length||(e=t.tag);const n=this.context.tagToUnitCompiler[e];let i;if(void 0!==n){try{i=await n(t,this)}catch(t){console.log(t),i=this.createErrorElement("Broken")}if(i.classList.contains("unit")&&i.classList.contains("warn"))return this.registerElement(i,t),this.unitToCompiling.set(t,!1),i}else B.includes(e)?(i=document.createElement(e),J.includes(e)?i.append(await this.compileInlineSTDN(t.children)):i.append(await this.compileSTDN(t.children))):Z.includes(e)?(i=document.createElementNS("http://www.w3.org/2000/svg",e),i.append(await this.compileInlineSTDN(t.children))):(i=document.createElement("div"),i.append(await this.compileSTDN(t.children)));i.classList.add("unit");try{i.classList.add(e),"string"==typeof t.options.class&&i.classList.add(...t.options.class.trim().split(/\s+/));for(const e of q("class",t.tag,this.context.tagToGlobalOptions))"string"==typeof e&&i.classList.add(...e.trim().split(/\s+/))}catch(t){console.log(t)}const o=[];let s=i.getAttribute("style");null!==s&&o.push(s),"string"==typeof t.options.style&&o.push(t.options.style);for(const e of q("style",t.tag,this.context.tagToGlobalOptions))"string"==typeof e&&o.push(e);if(o.length>0)try{i.setAttribute("style",o.join("; "))}catch(t){console.log(t)}const r=this.context.unitToId.get(t);void 0!==r&&(i.id=r);for(const e in t.options){if("id"===e||"class"===e||"style"===e)continue;let n=e;if(e.startsWith("data-")||Q.includes(e)||(n=`data-${e}`),i.hasAttribute(n))continue;let o=t.options[e];if(!0===o?o="":"number"==typeof o&&(o=o.toString()),"string"==typeof o){(n.endsWith("href")||n.endsWith("src"))&&$(o)&&(o=this.context.urlToAbsURL(o,t));try{i.setAttribute(n,o)}catch(t){console.log(t)}}}return this.registerElement(i,t),this.unitToCompiling.set(t,!1),i}async compileInline(t){return"string"!=typeof t?await this.compileUnit(t):new Text(t)}async compileLine(t){const e=new DocumentFragment;for(const n of t)e.append(await this.compileInline(n));return e}async compileInlineSTDN(t){const e=new DocumentFragment;for(let n=0;n<t.length;n++)e.append(await this.compileLine(t[n])),n!==t.length-1&&e.append(new Text("\n"));return e}async compileSTDN(t){const e=new DocumentFragment;for(const n of t){const t=document.createElement("div");t.classList.add("st-line"),e.append(t),t.append(await this.compileLine(n)),this.registerElement(t,n)}return e}}async function nt(t,e={}){const n=[];for(const{value:e,url:i}of t){const t=w(e);void 0!==t&&n.push({value:t,url:i})}const i=await Y(n,e),o=new et(i);return{compiler:o,documentFragment:await o.compileSTDN(i.stdn)}}async function it(t,e={}){const n=[];for(const e of await U(t,location.href))n.push((async()=>{try{const t=await fetch(e);return t.ok?[{value:await t.text(),url:e}]:[]}catch(t){return console.log(t),[]}})());return await nt((await Promise.all(n)).flat(),e)}var ot=e.Si,st=e.AT,rt=e.MY,at=e.yd,ct=e.h8,lt=e.l7,ut=e.gh,dt=e.Rs,ft=e.t$,ht=e.aV,pt=e.XY,gt=e.kC,mt=e.Ws,yt=e.fK,vt=e.wS,bt=e.Xg,Tt=e.TA,xt=e.tC,wt=e.q0,St=e.xU,It=e.On,jt=e._C,At=e.lV,Ot=e.$P,Lt=e.Iz,Ct=e.c4,$t=e.dt,Ut=e.FW;export{ot as Compiler,st as Counter,rt as compile,at as compileURLs,ct as createErrorElement,lt as extractContext,ut as extractGlobalChildren,dt as extractGlobalOptionArray,ft as extractGlobalStrings,ht as extractGlobalURLs,pt as extractLastGlobalOption,gt as extractPartToOffset,mt as extractUnitOrLineToPart,yt as extractUnitOrLineToPosition,vt as isRelURL,bt as lineToInlinePlainString,Tt as lineToPlainString,xt as stdnToInlinePlainString,wt as stdnToPlainString,St as stringToId,It as supportedAttributes,jt as supportedHTMLTags,At as supportedHTMLTagsWithInlineChildren,Ot as supportedSVGTags,Lt as unitToInlinePlainString,Ct as unitToPlainString,$t as urlsStrToAbsURLs,Ut as urlsToAbsURLs};